<!doctype html>
<html ng-app="jiesuan" ng-controller="needLoginController">
<head>
<meta charset="utf-8">
<meta name="renderer" content="webkit">
<meta name="force-rendering" content="webkit">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
<title>订单结算 - 新新农人</title>
    <!--[if lte IE 7]><script>alert('为了更好的购物体验，请升级您的浏览器版本');window.location.href='http://cdn.dmeng.net/upgrade-your-browser.html?referrer='+location.href;</script><![endif]-->
    <link rel='icon' href='images/title_logo.png' type='image/png' />
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="Cache-Control" content="no-cache, must-revalidate">
    <meta http-equiv="expires" content="Wed, 26 Feb 1997 08:21:57 GMT">
    <!-- build:css -->
    <link type="text/css" rel="stylesheet" href="css/style.css">
    <link type="text/css" rel="stylesheet" href="css/addAddress.css">
    <link type="text/css" rel="stylesheet" href="css/sweetalert.css">
    <!-- endbuild -->
    <!-- build:js -->
    <script src="js/jquery.min.js"></script>
    <script src="js/angular.min.js"></script>
    <script src="js/angular-cookies.min.js"></script>
    <script src="js/common.js"></script>
    <script src="js/login/loginService.js"></script>
    <script src="js/remoteApiService.js"></script>
    <script src="js/payService.js"></script>
    <script src="js/login/loginController.js"></script>
    <script src="js/headerFooterDirective.js"></script>
    <script src="js/headerController.js"></script>
    <script src="js/shoppingCart/shoppingCartService.js"></script>
    <script src="js/shoppingCart/shoppingCartController.js"></script>
    <script src="js/jiesuan/jiesuanController.js"></script>
    <script src="js/sweetalert.min.js"></script>
    <script src="js/sideService.js"></script>
    <!-- endbuild -->
<script type="text/javascript">
    var products = function(){
        function getQueryStringByName(name){
            var result = location.search.match(new RegExp("[\?\&]" + name+ "=([^\&]+)","i"));
            if(result == null || result.length < 1){
                return "";
            }
            return result[1];
        }

        try{
            var queryProducts = getQueryStringByName('products');
            queryProducts = decodeURI(decodeURI(queryProducts));
            queryProducts = JSON.parse(queryProducts);
            var returnProducts = [];
            for(var i in queryProducts){
                returnProducts[queryProducts[i].id] = queryProducts[i].count;
            }
            return returnProducts;
        }
        catch(err){
            return null;
        }
    }();
    var productFilter = products ? function(product){
        var productId = product._id;
        if(products[productId] != undefined){
            product.goodsCount = products[productId];
            return [true,product];
        }else{
            return [false,product];
        }
    } : null;
</script>
</head>
<body ng-controller="jiesuanController" class="confirm-order">
<header ng-controller="headerController"></header>
<div class="wrap nav">
    <h1 class="left logo"><a href="/">新新农人</a></h1>
    <ul class="right shopping_procedure">
        <li><img src="images/green1.png" alt=""/><p>我的购物车</p></li>
        <li class="procedure_line"><img src="images/green_line.png" alt=""/></li>
        <li><img src="images/green2.png" alt=""/><p>填写核对订单信息</p></li>
        <li class="procedure_line"><img src="images/gray_line.png" alt=""/></li>
        <li><img src="images/gray0k.png" alt=""/><p>成功提交订单</p></li>
    </ul>
</div>

<div class="clear channel3 cart_box">
    <div class="wrap checkout-steps">
        <p class="confirm-tit">
            <span class="left">确认收货信息</span>
        </p>
        <div class="consignee-cont">
            <div ng-hide="undefinedAddressMsg" class="consignee-cont-title">
                发货至
            </div>
            <ul>
                <li ng-repeat="contact in contacts" class="clearfix">
                    <div class="left name" ng-cloak>
                        <input type="radio" ng-checked='contact.selected' ng-click="selectAddress($index)"> {{contact.name}}
                    </div>
                    <div class="left address" ng-cloak>
                        {{contact.address}}
                    </div>
                    <div class="left tel" ng-cloak>
                        {{contact.phone}}
                    </div>
                    <div class="right opt">
                        <a href="" ng-click="editAddress($index)">编辑</a>
                        <a href="" ng-click="deleteAddress($index)">删除</a>
                    </div>
                </li>
            </ul>
            <p ng-cloak class="undefinedAddressMsg">{{undefinedAddressMsg}}</p>
        </div>
        <div class="addNewAddBtn clearfix">
            <a href="" ng-click="addNewAddress()" class="left xxnr_btn">添加新地址</a>
        </div>
    </div>
    <!--<div class="wrap clear checkout-steps">-->
        <!--<p class="confirm-tit">-->
            <!--<span class="left">选择支付方式</span>-->
        <!--</p>-->
        <!--<ul class="pay-style">-->
            <!--&lt;!&ndash;            <li><a href="#" ng-click="itemClicked($index)" ng-class="{ 'selected-class-name': $index == selectedIndex }"><img src="images/pay1.png" alt=""></a></li>-->
                        <!--<li><a href="#" ng-click="itemClicked($index)" ng-class="{ 'selected-class-name': $index == selectedIndex }"><img src="images/pay2.png" alt=""></a></li>-->
                        <!--<li><a href="#"><img src="images/pay3.png" alt=""></a></li>-->
                        <!--<li><a href="#"><img src="images/pay4.png" alt=""></a></li> &ndash;&gt;-->

            <!--<li ng-repeat="payMethod in payMethods"><a href=""  ng-class="{ 'current': $index == selectedPayMethodIndex }" ng-click="itemClicked($index)"><img ng-src="{{payMethod.imgUrl}}" alt=""></a></li>-->
        <!--</ul>-->
    <!--</div>-->
    <div ng-controller="shoppingCartController" class="jiesuan">
        <div class="wrap">
            <div class="cart">
                <div class="cart-main">
                    <p class="confirm-tit">
                        <span class="left">确认订单信息</span>
                    </p>
                    <div class="cart-thead">
                        <div class="column t-goods t-goods2">商品信息</div>
                        <div class="column t-price">单价(元)</div>
                        <div class="column t-quantity">数量</div>
                        <div class="column t-sum">合计(元)</div>
                    </div>
                    <div class="cart-list">
                        <div class="cart-item-list">
                            <div class="cart-tbody" ng-repeat="shop in shops">
                                <div class="shop">
                                    <span class="shop-txt">
                                            <a class="shop-name" href="" target="_blank"  ng-cloak>{{shop.name}}</a>
                                    </span>
                                </div>
                                <div class="item-list">
                                    <div class="item-single item-item" ng-repeat="item in shop.items">
                                        <div class="item-form">
                                            <div class="cell p-goods p-goods2">
                                                <div class="goods-item">
                                                    <div class="item-msg clearfix">
                                                        <div class="p-img">
                                                            <a ng-href={{item.detailPageUrl}}>
                                                                <img ng-src={{item.thumbnailUrl}}>
                                                            </a>
                                                        </div>
                                                        <div class="p-name">
                                                            <a ng-href={{item.detailPageUrl}} ng-cloak>{{item.name}}</a>
                                                        </div>
                                                        <div class="p-skus">
                                                            <ul>
                                                                <li ng-repeat="attribute in item.attributes">
                                                                    {{attribute.name}}: {{attribute.value}} ;&nbsp;
                                                                </li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="cell p-props-price" ng-cloak>￥{{item.nowPrice}}
                                            </div>
                                            <div class="cell p-buy-count" ng-cloak>{{item.buyCount}}</div>
                                            <div class="cell p-sum">
                                                <!--<div ng-cloak>{{item.totalDeposit}}<span ng-show="{{item.deposit}}">（订金）</span></div>-->
                                                <div class="ng-cloak" ng-class="{'hasDeposit':item.hasDeposit}">¥ {{item.totalPrice.toFixed(2)}}</div>

                                            </div>
                                        </div>
                                        <div class="p-additions" ng-if="item.additions" >
                                            <!-- <ul ng-if="product.addition"> -->
                                            <div class="p-additions-title">
                                                附加项目:
                                            </div>
                                            <div class="p-additions-contents">
                                                <p ng-repeat="addition in item.additions" class="p-additions-content">
                                                    <span class="addition-name">{{addition.name}}</span>
                                                    <span class="addition-price">￥ {{addition.price.toFixed(2)}}</span>
                                                    <span class="addition-count">{{item.buyCount}}</span>
                                                    <span class="addition-totalPrice">￥ {{(item.buyCount*addition.price).toFixed(2)}}</span>
                                                </p>
                                            </div>
                                        </div>
                                        <div class="pay-step" ng-show="{{item.hasDeposit}}">
                                            <div class="ng-cloak pay-step-1"><span class="text-info">阶段一：订金</span><span class="order-price ng-cloak">¥ {{item.totalDeposit.toFixed(2)}}</span></div>
                                            <div class="ng-cloak pay-step-2"><span class="text-info">阶段二：尾款</span><span class="balance ng-cloak">¥ {{(item.totalPrice + item.buyCount*item.additionsTotalPrice - item.totalDeposit).toFixed(2)}}</span></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="wrap options-box">
            <div class="changeCart left"><a href="cart.html"><返回修改购物车</a></div>

            <div class="right submit-btn"><a href="" ng-click="buy()">提交订单</a></div>
            <div class="right price-total">
                <p><label>商品数量：</label><span ng-cloak>{{totalCount}}</span></p>
                <p><label>总价（不计运费）：</label><span class="total" ng-cloak>￥{{totalPrice}}</span></p>
                <!--<p><label>已节省：</label><span ng-cloak>{{totalSaving}}元</span></p>-->
            </div>
        </div>
    </div>
</div>
<footer></footer>

<div class="modify-address" ng-cloak>
    <div id="D-overlar" ng-show="showPop"></div>
    <div id="D3" ng-show="showModifyPop">
        <a ng-href="" ng-click='hideModifyPop()' id="close2" class="close"><img src="images/close.png" alt=""></a>
        <h1>修改地址</h1>
        <table>
            <tr>
                <td class="first-td" style="vertical-align:top;">请选择省<span>*</span></td>
                <td class="second-td">
                    <select name="" id="provin" ng-model="modifyAddress.province" ng-options="province as province.name for province in provinces" ng-change="getCityList()">
                    </select>
                    <select name="" id="city" ng-model="modifyAddress.city" ng-options="city as city.name for city in cities" ng-change="getCountyList()">
                    </select>
                    <select ng-show="modifyAddress.county" name="" id="county" ng-model="modifyAddress.county" ng-options="county as county.name for county in counties" ng-change="getTownList()">
                    </select>
                    <select name="" id="town" ng-model="modifyAddress.town" ng-options="town as town.name for town in towns">
                    </select>
                    <span style="color: #999999" id="address_detail"></span>
                </td>
            </tr>
            <tr>
            <tr>
                <td class="first-td" style="vertical-align:top;">
                    地址详情信息<span>*</span>
                    <div class="s">(请填写详细的)</div>
                </td>
                <td class="second-td">
                    <textarea name=""  class="dizhi" ng-model="modifyAddress.detailAddress"></textarea>
                </td>
            </tr>
            <tr>
                <td class="first-td">邮政编码</td>
                <td class="second-td"><input type="text" value="" class="youbian" ng-model="modifyAddress.zipCode"></td>
            </tr>
            <tr>
                <td class="first-td">收货人姓名<span>*</span></td>
                <td class="second-td"><input type="text" class="shouhuoren" value="" ng-model="modifyAddress.receiptName"></td>
            </tr>
            <tr>
                <td class="first-td">手机号码<span>*</span></td>
                <td class="second-td">
                    <select name="" id="select1">
                        <option value="">中国大陆 +86</option>
                    </select>
                    <input type="text" class="mobile-num" value="" ng-model="modifyAddress.phone">
                </td>
            </tr>
            <tr>
                <td class="first-td">&nbsp;</td>
                <td class="second-td">
                    <input type="checkbox" name="" id="checkbox1" ng-checked="modifyAddress.isDefault" ng-model="modifyAddress.isDefault">
                    <label for="checkbox1">设为默认地址</label>
                </td>
            </tr>
            <tr>
                <td class="first-td">&nbsp;</td>
                <td class="second-td"><input type="submit" value="提交" class="tijiao" ng-click="submitAddressEdit()"></td>
            </tr>
        </table>
    </div>
    <div id="D4" ng-show="showAddPop">  <!-- 添加地址弹框结构 -->
        <a href="" ng-click='hideAddPop()' id="close3" class="close"><img src="images/close.png" alt=""></a>
        <h1>添加地址</h1>
        <table>
            <tr>
                <td class="first-td" style="vertical-align:top;">请选择省<span>*</span></td>
                <td class="second-td">
                    <select name="" id="provin" ng-model="modifyAddress.province" ng-options="province as province.name for province in provinces" ng-change="getCityList()">
                    </select>
                    <select name="" id="city" ng-model="modifyAddress.city" ng-options="city as city.name for city in cities" ng-change="getCountyList()">
                    </select>
                    <select name="" ng-show="modifyAddress.county" id="county" ng-model="modifyAddress.county" ng-options="county as county.name for county in counties" ng-change="getTownList()">
                    </select>
                    <select name="" id="town" ng-model="modifyAddress.town" ng-options="town as town.name for town in towns">
                    </select>
                    <span style="color: #999999" id="address_detail"></span>
                </td>
            </tr>
            <tr>
            <tr>
                <td class="first-td" style="vertical-align:top;">
                    地址详情信息<span>*</span>
                    <div class="s">(请填写详细的)</div>
                </td>
                <td class="second-td">
                    <textarea name=""  class="dizhi" ng-model="modifyAddress.detailAddress"></textarea>
                </td>
            </tr>
            <tr>
                <td class="first-td">邮政编码</td>
                <td class="second-td"><input type="text" value="" class="youbian" ng-model="modifyAddress.zipCode"></td>
            </tr>
            <tr>
                <td class="first-td">收货人姓名<span>*</span></td>
                <td class="second-td"><input type="text" class="shouhuoren" value="" ng-model="modifyAddress.receiptName"></td>
            </tr>
            <tr>
                <td class="first-td">手机号码<span>*</span></td>
                <td class="second-td">
                    <select name="" id="select1">
                        <option value="">中国大陆 +86</option>
                    </select>
                    <input type="text" class="mobile-num" value="" ng-model="modifyAddress.phone">
                </td>
            </tr>
            <tr>
                <td class="first-td">&nbsp;</td>
                <td class="second-td">
                    <input type="checkbox" name="" id="checkbox1" ng-checked="modifyAddress.isDefault" ng-model="modifyAddress.isDefault">
                    <label for="checkbox1">设为默认地址</label>
                </td>
            </tr>
            <tr>
                <td class="first-td">&nbsp;</td>
                <td class="second-td"><input type="submit" value="提交" class="tijiao" ng-click="submitAddressAdd()"></td>
            </tr>
        </table>
    </div>
</div>

</body>
</html>
