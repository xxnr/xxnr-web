<?php

include_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'des.php';
include_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'TripleDES.php';

$data = null;
$key = null;

for($i=0; $i<$argc; $i++){
	$arg = $argv[$i];

	if(substr($arg, 0, 7) === '--data='){
		$data = substr($arg, 7);
	}

	if(substr($arg, 0, 6) === '--key='){
    		$key = substr($arg, 6);
    	}
}

//$des = new Des();
//echo $des->decode($data, $key);

$tripleDES = new TripleDES($key);
$tripleDES->decrypt(hex2bin($data));
//echo hex2bin("7B226163636F756E74223A223632313636312A2A2A2A2A2A2A2A2A38303032222C22616D6F756E74223A223538222C2262617463684E6F223A22303030303030222C2263757272656E6379436F6465223A22313536222C226465616C44617465223A22323031362D30342D3036222C226465616C537461747573223A2232222C226465616C54696D65223A2231353A30333A3335222C226465766963654964223A223030303131303033313330303030353739323533222C226C697144617465223A2230343036222C226D656D6F223A22222C226D65726368616E744964223A2273686F756A69303030303030303034222C226D65726368616E744E616D65223A2231222C226D65726368616E744F726465724964223A22323031363034303630303237333232333034222C226F726465724964223A22363432303136303430363238353435333433222C22706F735365714964223A22303135333932222C227265664964223A22303030313037343034383539222C22737562496E7374223A22303030313030222C227465726D4964223A22736A303030303033227D");

//$input = '{"account":"621661*********8002","amount":"58","batchNo":"000000","currencyCode":"156","dealDate":"2016-04-06","dealStatus":"2","dealTime":"15:03:35","deviceId":"00011003130000579253","liqDate":"0406","memo":"","merchantId":"shouji000000004","merchantName":"1","merchantOrderId":"201604060027322304","orderId":"642016040628545343","posSeqId":"015392","refId":"000107404859","subInst":"000100","termId":"sj000003"}';
//echo "\n";
//echo $tripleDES->encrypt($input);
//echo "\n";

function hex_to_base64($hex){
  $return = '';
  foreach(str_split($hex, 2) as $pair){
    $return .= chr(hexdec($pair));
  }
  return base64_encode($return);
}

?>